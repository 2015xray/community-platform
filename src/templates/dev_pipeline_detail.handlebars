<div id="sidebar-top" class="clearfix">
  <span class="left">
    {{#if pr}}{{#each pr.tags}}{{#eq (slug name) 'priorityhigh'}} 
        <span class="sep--after">
            <i class="icon-star-empty" />
        </span>
    {{/eq}}{{/each}}{{/if}}
    {{#if permissions.admin}}
        <span class="sep--after edit-sidebar" id="edit-sidebar-repo">
            <select>
                <option value="0">{{repo}}</option>
                {{#not_eq repo 'fathead'}}<option value="1">fathead</option>{{/not_eq}}
                {{#not_eq repo 'goodies'}}<option value="2">goodies</option>{{/not_eq}}
                {{#not_eq repo 'longtail'}}<option value="3">longtail</option>{{/not_eq}}
                {{#not_eq repo 'spice'}}<option value="4">spice</option>{{/not_eq}}
            </select>
        </span>

        <span class="sep--after edit-sidebar" id="edit-sidebar-dev_milestone">
            <select>
                <option value="0">{{dev_milestone}}</option>
                {{#not_eq dev_milestone 'planning'}}<option value="1">planning</option>{{/not_eq}}
                {{#not_eq dev_milestone 'development'}}<option value="2">development</option>{{/not_eq}}
                {{#not_eq dev_milestone 'testing'}}<option value="3">testing</option>{{/not_eq}}
                {{#not_eq dev_milestone 'complete'}}<option value="4">complete</option>{{/not_eq}}
                <option value="5">live</option>
                <option value="6">ghosted</option>
            </select>
        </span>
    {{else}}
        {{#if repo}}
            <span class="sep--after"> {{repo}} </span>
            
        {{/if}}
        <span> {{dev_milestone}} </span>
    {{/if}}
  </span>

    <span id="sidebar-close" class="right"> <i class="ddgsi ddgsi-close"></i> </span>
</div>

{{#if permissions.admin}}

    <h2 id="sidebar-name">
        <input class="edit-sidebar" id="edit-sidebar-name" value="{{name}}" />
    </h2>

    <input class="edit-sidebar" id="edit-sidebar-id" value="{{id}}" />

    <div class="sidebar-field">
        <div class="field-label primary-label"> Description </div>
        <textarea rows="3" cols="50" class="edit-sidebar" id="edit-sidebar-description">{{description}}</textarea>
    </div>

    <div class="sidebar-field">
        <div class="field-label primary-label"> Example Query </div>
        <input class="edit-sidebar" id="edit-sidebar-example_query" value="{{example_query}}" />
    </div>

    <div class="sidebar-field">
        <div class="field-label primary-label"> Perl Module </div>
        <input class="edit-sidebar" id="edit-sidebar-perl_module" value="{{perl_module}}" />
    </div>

    <div class="sidebar-field">
        <div class="field-label primary-label"> Producer </div>
        <input class="edit-sidebar" id="edit-sidebar-producer" value="{{producer}}" />
    </div>

    <div class="sidebar-field">
        <div class="field-label primary-label"> Template </div>
        <input class="edit-sidebar" id="edit-sidebar-template" value="{{template}}" />
    </div>

    <div class="sidebar-field">
        <div class="field-label primary-label"> Dev Machine </div>
        <select class="edit-sidebar select-sidebar" id="edit-sidebar-test_machine">
            {{#if test_machine}}<option value="0">{{test_machine}}</option>{{/if}}
            <option></option>
            {{#not_eq test_machine 'ddh1'}}<option value="1">ddh1</option>{{/not_eq}}
            {{#not_eq test_machine 'ddh2'}}<option value="2">ddh2</option>{{/not_eq}}
            {{#not_eq test_machine 'ddh3'}}<option value="3">ddh3</option>{{/not_eq}}
            {{#not_eq test_machine 'ddh4'}}<option value="4">ddh4</option>{{/not_eq}}
            {{#not_eq test_machine 'ddh5'}}<option value="5">ddh5</option>{{/not_eq}}
            {{#not_eq test_machine 'ddh6'}}<option value="6">ddh6</option>{{/not_eq}}
            {{#not_eq test_machine 'ddh7'}}<option value="7">ddh7</option>{{/not_eq}}
            {{#not_eq test_machine 'ddh8'}}<option value="8">ddh8</option>{{/not_eq}}
            {{#not_eq test_machine 'ddh9'}}<option value="9">ddh9</option>{{/not_eq}}
            {{#not_eq test_machine 'ddh10'}}<option value="10">ddh10</option>{{/not_eq}}
            {{#not_eq test_machine 'beta'}}<option value="11">beta</option>{{/not_eq}}
        </select>
    </div>

    <div class="sidebar-field">
        <div class="field-label primary-label"> Asana Tasks </div>
        {{#if asana}}
            <span class="readonly">
                <a href="https://app.asana.com/0/0/{{asana.asana_id}}">One open task</a>
            </span>
        {{else}}
            <div class="button btn--primary" id="asana-create">Create Task</div>
        {{/if}}
    </div>
{{else}}
    {{#if name}}
      <h2 id="sidebar-name"> {{name}} </h2>
    {{/if}}

    {{#if id}}
        <div id="sidebar-id">
            <span> {{id}} </span>
        </div>
    {{/if}}

    {{#if description}}
        <div id="sidebar-desc" class="sidebar-field">
            <div class="field-label primary-label"> Description </div>
            <span class="readonly"> {{description}} </span>
        </div>
    {{/if}}

    {{#if example_query}}
        <div id="sidebar-example" class="sidebar-field">
            <div class="field-label primary-label"> Example Query </div>
            <span class="readonly"> {{example_query}} </span>
        </div>
    {{/if}}

    {{#if perl_module}}
        <div id="sidebar-perl_module" class="sidebar-field">
            <div class="field-label primary-label"> Perl Module </div>
            <span class="readonly"> {{perl_module}} </span>
        </div>
    {{/if}}
{{/if}}

{{#if pr}}
    <hr />

    <div id="sidebar-pr">
        <div class="left">
            <a href="https://github.com/duckduckgo/zeroclickinfo-{{repo}}/issues/{{pr.issue_id}}" class="one-line" id="pr">
                PR #{{pr.issue_id}}
            </a>
        </div>
        <div class="right" title="{{format_time last_update}}">
            <i class="ddgsi-clock" />
            {{timeago last_update}}
        </div>
        {{#if last_comment}}
            <div class="right" id="all_comments">
                <i class="ddgsi-comment" />
                {{length all_comments}}
            </div>
        {{/if}}

        <span class="clearfix"></span>
        
        {{#each all_comments}}
            <p class="comment">
                <a href="https://github.com/duckduckgo/zeroclickinfo-{{../repo}}/issues/{{../pr.issue_id}}#issuecomment-{{id}}">
                    {{text}}
                </a>
            </p>
            <div>{{timeago date}}</div>
        {{/each}}
    </div>        
{{/if}}

